# MySQL #

## 事务 ##
- 事务是被绑定在一起的作为一个逻辑工作单元的SQL语句分组，如果任何一个操作失败那么整个操作就被失败，以后操作就会回滚到操作前状态，或者是上有个节点。

    为了确保要么执行，要么不执行，就可以使用事务。要将一组语句作为事务考虑，就需要通过 ACID 测试，即原子性，一致性，隔离性和持久性。
## 数据库事务的四个特性及含义 ##
- 原子性：整个事务中的所有操作，要么全部完成，要么全部不完成，
不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚
（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。

- 一致性：事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。

- 隔离性：隔离状态执行事务，使它们像是在系统给定时间内执行的唯一操作。如果有多个事务，在相同的时间内执行相同的事务，隔离性使得每个事务在系统中认为只有该事务在使用系统。
- 永久性：事务完成以后，该事务对DB所做的更改便永久的保存在DB之中，并不会被回滚。


## 锁 ##
- 在所有的 DBMS 中，锁是实现事务的关键，锁可以保证事务的完整性和并发性。与现实生活中锁一样，它可以使某些数据的拥有者，在某段时间内不能使用某些数据或数据结构。当然锁还分级别的。

## drop/truncate/delete的区别 ##

- drop是删除表，直接删掉表结构和数据

- truncate是删掉表中所有的数据，在插入记录时自增长id又从1重新开始

- delete操作可以加where子句，是一条一条地执行的

- drop/truncate操作不可恢复，delete操作会被放到rollback segment中，事务提交之后才会生效，数据可以通过回滚进行恢复

## 数据库引擎 ##

两种引擎:InnoDB/MyISAM


- InnoDB支持事务,MyISAM不支持事务

- InnoDB支持行级锁，MyISAM支持表级锁 

- InnoDB支持外键，MyISAM不支持外键


## 数据库表结构优化 ##
数据库范式优化，消除冗余

- 第一范式：所有属性不可再分

- 第二范式：不存在非主属性对码的部分依赖（所有属性必须完全依赖于码）

- 第三范式：不存在传递依赖

## 数据库的大表优化 ##
1. 读写分离：对数据库进行拆分，master库负责写入数据，slave库负责读取数据，master向slave同步数据，而slave不会向master同步数据，需要在多个服务器中配置MySQL配置文件
2. 垂直分区：根据数据库表中数据的相关性进行拆分。（对数据库的列进行拆分）
3. 水平分区：保持数据库表结构不变，存储数据分片。（把一张表拆成多张表进行存储）

## 数据库的三级模式 ##
1. 模式又称逻辑模式，是数据库全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图。模式实际上是数据库数据在逻辑结构上的视图，一个数据库只能有一个模式。
2. 外模式也称子模式或用户模式，它是用户所能看见和使用的局部数据的逻辑结构和特征的描述。外模式是模式的子集，一个数据库可以由很多外模式。
3. 内模式也称存储模式，一个数据库只有一个内模式。它是数据库存储方式和物理结构的描述，是数据库内部的组织方式。

## char和varchar的区别 ##
char和varchar都可以用来存储字符串，而varchar存储的字符串长度是可变的。

比如，存储字符串“abc”对于char(20)，表示你存储的字符将占20个字节，
包含17个空，而同样的varchar2（20）只占了3个字节，20只是最大值，
当你存储的字符小于20时，按实际长度存储。

char的效率比varchar高。

## SQL语句优化 ##
1. 索引失效的情况:
	
	where子句中使用!=或者<>操作符；

	对字段进行null值判断；

	以“%”开头的like语句，模糊匹配；

	数据类型出现隐式转换（如varchar类型的数据如果不加引号，则自动转换为int类型）；

	在列上进行运算。

2. 尽量用where子句替换having，因为having只会在检索出所有记录之后才会对结果集进行过滤。
3. 查询单条记录时，使用limit 1限制，避免全表扫描。

## 丢失修改、不可重复读、脏读、幻读
- 丢失修改：两个事务T1和T2读入同一数据并修改、T2提交的结果破坏了T1提交的结果，导致T1的修改被丢失。

- 不可重复读：事务T1读取数据之后，事务T2执行更新操作，使T1无法再现第一次读取结果。

- 脏读：事务T1修改某一数据，并将其写回磁盘，事务T2读取同一数据后，T1由于某种原因被撤销，这是	T1已修改过的数据恢复原值，T2读到的数据与数据库中的数据不一致，则T2读到的数据就是脏数据，即不正确的数据。

- 幻读：事务T1首先根据条件索引得到N条数据，然后事务T2改变了这N条数据之外的M条或者增添了M条符合事务T1搜索条件的数据，导致事务T1再次搜索发现有N+M条数据了，就产生了幻读。

### 不可重复读和幻读比较
两者有些相似，但是前者针对的是update或delete，后者针对的insert。
## DDL,DML,DCL,DQL

- DDL是数据定义语言，常见的有create，drop，alter
- DML是数据操纵语言，常见的有delete，insert，update
- DCL是数据控制语言，常见的有grant，revoke
- DQL是数据查询语言，有select


2019/1/12 16:00:49 
